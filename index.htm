<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Manager</title>
    <script>
        const API_BASE_URL = "https://tarks.karankhosla99.workers.dev";

        document.addEventListener("DOMContentLoaded", function () {
            checkAuthStatus();
        });

        async function loginOrSignup(isSignup) {
            const username = document.getElementById("username").value;
            const password = document.getElementById("password").value;

            if (!username || !password) {
                alert("Please enter both username and password.");
                return;
            }

            const endpoint = isSignup ? `${API_BASE_URL}/users` : `${API_BASE_URL}/users/${username}`;
            const method = isSignup ? "POST" : "GET";

            const response = await fetch(endpoint, {
                method: method,
                headers: { "Content-Type": "application/json" },
                body: isSignup ? JSON.stringify({ username, password }) : null
            });

            if (response.ok) {
                document.cookie = "auth_status=true; path=/";
                document.getElementById("auth-section").style.display = "none";
                document.getElementById("actions").style.display = "block";
            } else {
                alert("Invalid login or signup failed.");
            }
        }

        function checkAuthStatus() {
            const cookies = document.cookie.split("; ");
            const isAuthenticated = cookies.some(cookie => cookie.startsWith("auth_status=true"));
            document.getElementById("auth-section").style.display = isAuthenticated ? "none" : "block";
            document.getElementById("actions").style.display = isAuthenticated ? "block" : "none";
        }

        async function logout() {
            document.cookie = "auth_status=false; path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC";
            document.getElementById("auth-section").style.display = "block";
            document.getElementById("actions").style.display = "none";
        }

        async function performAction(action) {
            let endpoint = "";
            let method = "";
            let body = null;

            switch (action) {
                case "createUser":
                    const newUsername = prompt("Enter new username:");
                    const newPassword = prompt("Enter password:");
                    if (!newUsername || !newPassword) return;
                    endpoint = `${API_BASE_URL}/users`;
                    method = "POST";
                    body = JSON.stringify({ username: newUsername, password: newPassword });
                    break;
                case "deleteUser":
                    const username = prompt("Enter username to delete:");
                    if (!username) return;
                    endpoint = `${API_BASE_URL}/users/${username}`;
                    method = "DELETE";
                    break;
                case "createProject":
                    const projectName = prompt("Enter project name:");
                    const projectDescription = prompt("Enter project description:");
                    if (!projectName) return;
                    endpoint = `${API_BASE_URL}/projects`;
                    method = "POST";
                    body = JSON.stringify({ project_name: projectName, project_description: projectDescription });
                    break;
                case "deleteProject":
                    const projectId = prompt("Enter project ID to delete:");
                    if (!projectId) return;
                    endpoint = `${API_BASE_URL}/projects/${projectId}`;
                    method = "DELETE";
                    break;
                case "createTask":
                    const taskName = prompt("Enter task name:");
                    const taskDescription = prompt("Enter task description:");
                    const assignedTo = prompt("Assign task to (username):");
                    const assignedBy = prompt("Assigned by (your username):");
                    const deadline = prompt("Enter deadline (YYYY-MM-DD):");
                    const projectID = prompt("Enter project ID:");
                    const status = prompt("Enter task status (0=Pending, 1=In Progress, 2=Completed):");
                    if (!taskName || !assignedTo || !projectID) return;
                    endpoint = `${API_BASE_URL}/tasks`;
                    method = "POST";
                    body = JSON.stringify({
                        taskname: taskName,
                        taskdescription: taskDescription,
                        assigned_to: assignedTo,
                        assigned_by: assignedBy,
                        deadline: deadline,
                        projectid: projectID,
                        status: status
                    });
                    break;
                case "deleteTask":
                    const taskId = prompt("Enter task ID to delete:");
                    if (!taskId) return;
                    endpoint = `${API_BASE_URL}/tasks/${taskId}`;
                    method = "DELETE";
                    break;
                case "viewTasks":
                    endpoint = `${API_BASE_URL}/tasks`;
                    method = "GET";
                    break;
                default:
                    alert("Invalid action.");
                    return;
            }

            const response = await fetch(endpoint, {
                method,
                headers: { "Content-Type": "application/json" },
                body: body ? body : null
            });

            const data = await response.json();
            alert(JSON.stringify(data, null, 2));
        }
    </script>
</head>
<body>
    <h1>Task Manager</h1>

    <div id="auth-section">
        <h2>Login or Sign Up</h2>
        <input type="text" id="username" placeholder="Username">
        <input type="password" id="password" placeholder="Password">
        <button onclick="loginOrSignup(false)">Login</button>
        <button onclick="loginOrSignup(true)">Sign Up</button>
    </div>

    <div id="actions" style="display: none;">
        <h2>Actions</h2>
        <button onclick="performAction('createUser')">Create User</button>
        <button onclick="performAction('deleteUser')">Delete User</button>
        <button onclick="performAction('createProject')">Create Project</button>
        <button onclick="performAction('deleteProject')">Delete Project</button>
        <button onclick="performAction('createTask')">Create Task</button>
        <button onclick="performAction('deleteTask')">Delete Task</button>
        <button onclick="performAction('viewTasks')">View Tasks</button>
        <button onclick="logout()">Logout</button>
    </div>
</body>
</html>
